// All Bot Events Overview 
// Overview of all bot events from OpenTelemetry implementation

dependencies
| where timestamp > ago(7d)
| where name in ("Bot Message", "Custom Event") or 
       (type == "InProc" and name != "" and name !contains "get_" and name !contains "POST /openai")
| extend EventType = case(
    name == "Bot Message", "Bot Message",
    name == "Custom Event", "Custom Event", 
    type == "InProc" and name !in ("Bot Message", "Custom Event"), "Operation",
    "Other"
)
| extend EventName = case(
    // Extract event name from Custom Event spans
    name == "Custom Event" and isnotempty(customDimensions["event.name"]), tostring(customDimensions["event.name"]),
    // Use operation name for operation spans
    name == "ProactiveMessage", "ProactiveMessage",
    name == "Bot Message", "Bot_Message",
    // For other operations, use the name directly
    name
)
| where EventName != "Other" and EventName != ""
| summarize Count = count() by EventName, bin(timestamp, 1h)
| render timechart
